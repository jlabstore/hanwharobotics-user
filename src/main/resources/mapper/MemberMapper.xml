<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hanwha.robotics.user.mapper.MemberMapper">

    <!-- 회원가입 -->
    <insert id="insertMember" parameterType="com.hanwha.robotics.user.dto.MemberRequest">
        INSERT INTO tb_member
        (member_id, password, company_name, region, city, post_code, address, address_detail, store, member_name, position,
         email, contact, accept_yn, create_date)
        VALUES (#{memberId}, #{password}, #{companyName}, #{region}, #{city}, #{postCode}, #{address}, #{addressDetail},
                #{store}, #{name}, #{position}, #{email}, #{contact}, (SELECT member_accept FROM tb_policy),
                current_timestamp)
    </insert>

    <update id="updatePassword" parameterType="String">
        UPDATE tb_member
        SET password = #{password}
        WHERE member_id = #{memberId}
    </update>

    <!--    <select id="checkMemberId" resultType="int" parameterType="String">-->
    <!--        SELECT-->
    <!--            COUNT(*)-->
    <!--        FROM tb_member-->
    <!--        WHERE member_id = #{ memberId }-->
    <!--    </select>-->

    <!-- 아이디 중복확인-->
    <select id="checkMemberId" resultType="int" parameterType="String">
        SELECT COUNT(*)
        FROM (SELECT member_id
              FROM tb_member
              WHERE member_id = #{memberId}
              UNION
              SELECT member_id
              FROM tb_deleted_account
              WHERE member_id = #{memberId}) as member
    </select>

    <!-- 로그인 , 비밀번호 찾기 -->
    <select id="selectByMemberId" resultType="com.hanwha.robotics.user.entity.Member" parameterType="String">
        SELECT *
        FROM tb_member
        WHERE member_id = #{memberId}
    </select>


    <select id="selectByMemberNo" resultType="com.hanwha.robotics.user.entity.Member" parameterType="int">
        SELECT *
        FROM tb_member
        WHERE member_no = #{memberNo}
    </select>


    <!-- 아이디 찾기 -->
    <select id="selectByEmail" resultType="com.hanwha.robotics.user.entity.Member" parameterType="String">
        SELECT *
        FROM tb_member
        WHERE email = #{email}
    </select>


    <select id="selectByMemberIdAndEmail" resultType="com.hanwha.robotics.user.entity.Member" parameterType="String">
        SELECT *
        FROM tb_member
        WHERE member_id = #{memberId}
          AND email = #{email}
    </select>

    <select id="findByMemberNo" resultType="com.hanwha.robotics.user.dto.MemberResponse" parameterType="int">
        SELECT *
        FROM tb_member
        WHERE member_no = #{memberNo}
    </select>



</mapper>