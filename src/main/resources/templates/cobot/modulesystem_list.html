<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/sub_layout.html}">
<body>
<div layout:fragment="content">

  <main class="ecosystem">
    <section class="ecosystem-title">
      <h1>자동화 시스템</h1>
      <p>한화로보틱스의 최첨단 기술력으로 만들어진 다양한 자동화 <br/>시스템 모듈 솔루션을 만나보세요.</p>
    </section>

    <section class="ecosystem-section">
      <div class="tab-nav">
        <div class="tab-nav-wrapper">

          <input type="radio" id="nav1" name="nav" checked />
          <label for="nav1" class="ecosystem-nav1">
            <span>전체</span>
          </label>
          <th:block th:each="robotCategory, stat : ${robotCategory}">
            <input type="radio" th:id="'nav' + ${stat.index + 2}" name="nav" />
            <label th:for="'nav' + ${stat.index + 2}"
                   th:data-category="${robotCategory.categoryNm}"
                   th:data-category-no="${robotCategory.categoryNo}"
                   th:value="${robotCategory.categoryNo}"
            >
              <span th:text="${robotCategory.categoryNm}"></span>
            </label>
          </th:block>

          <select class="tab-nav-mobile">
            <option value="" th:selected="true">전체</option>
            <th:block th:each="robotCategory, stat : ${robotCategory}">
              <option th:value="${robotCategory.categoryNo}" th:text="${robotCategory.categoryNm}"></option>
            </th:block>
          </select>


          <div class="tab-content-wrapper">
            <div id="nav1-content" class="nav-content">
              <div class="ecosystem-main-slider1" id="ecosystem-main-slider1">
              </div>
            </div>

            <div id="nav2-content" class="nav-content">
              <div class="ecosystem-main-slider1" id="ecosystem-main-slider2">
              </div>
            </div>

            <div id="nav3-content" class="nav-content">
              <div class="ecosystem-main-slider1" id="ecosystem-main-slider3">
              </div>
            </div>

            <div id="nav4-content" class="nav-content">
              <div class="ecosystem-main-slider1" id="ecosystem-main-slider4">
              </div>
            </div>
          </div>

        </div>
      </div>
    </section>


    <script id="slider-template" type="x-tmpl-mustache" class="hide">
      {{#items}}
        <a href="/cobot/modulesystem/{{robotNo}}" class="ecosystem-main-slider-item">
          <div class="ecosystem-main-slider-item-img">
            <img src="{{thumbnailUrl}}" alt="{{robotNm}}" />
          </div>
          <p>{{robotNm}}</p>
          <span>{{description}}</span>
        </a>
      {{/items}}
    </script>

  </main>


</div>

</body>

<th:block layout:fragment="script">
  <script type="text/javascript">

    $(document).ready(function () {
      $("input[name='nav']").off("change");
      $(".tab-nav-mobile").off("change");

      getList("");

      $("input[name='nav']").on("change", function (e) {
        e.stopPropagation();
        let categoryNo = $(this).next("label").data("category-no") || "";
        getList(categoryNo);
      });

      $(".tab-nav-mobile").on("change", function () {
        let categoryNo = $(this).val();
        getList(categoryNo);
      });

    });

    function getList(categoryNo) {
      COMM.ajax({
        url: '/cobot',
        type: 'POST',
        data: {
          boardType1: 'AUTO_SYSTEM',
          boardType2: 'CO_ROBOT',
          categoryNo: categoryNo
        },
        dataType: 'json',
        success: function(data) {
          console.log("서버에서 받은 데이터:", data);
          const navNum = $('[name=nav]:checked').attr('id').replace('nav','');
          const $slider = $('#ecosystem-main-slider'+ navNum);

          console.log($slider)

          // if ($slider.hasClass('slick-initialized')) {
          //   console.log('2')
          //   $slider.slick('unslick');
          // }
          console.log('3')

          const template = $("#slider-template").html();
          const rendered = Mustache.render(template, { items: data.data });

          console.log("렌더링된 HTML:", rendered);
          $slider.html(rendered);
          initializeSlider();
        },
        error: function(xhr, status, error) {
          console.error('ajax 요청 실패', status, error);
        }
      });
    }

    function initializeSlider() {
      console.log("슬라이더 초기화 시작");

      $(".ecosystem-main-slider1, .ecosystem-main-slider2, .ecosystem-main-slider3, .ecosystem-main-slider4").each(function () {
        const $slider = $(this);

        if ($slider.hasClass('slick-initialized')) {
          $slider.slick('unslick');
        }

        $slider.slick({
          dots: true,
          arrows: true,
          infinite: false,
          autoplay: false,
          slidesPerRow: 3,
          rows: 1,
          prevArrow: "<button type='button' class='slick-prev'><img src='../images/pc/robots_slider_arrow_left.svg' alt='' /></button>",
          nextArrow: "<button type='button' class='slick-next'><img src='../images/pc/robots_slider_arrow_right.svg' alt='' /></button>",
          responsive: [
            {
              breakpoint: 1025,
              settings: {
                slidesPerRow: 2,
                rows: 1,
              }
            },
            {
              breakpoint: 765,
              settings: {
                slidesPerRow: 1,
                rows: 1,
              }
            },
          ]
        });
      });

      console.log("슬라이더 초기화 완료");
    }


  </script>
</th:block>

</html>



