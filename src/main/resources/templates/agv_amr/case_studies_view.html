<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/sub_layout.html}">
<body data-gnb-target="agv_amr">
<main layout:fragment="content" class="casestudies view ecosystem-template-01 type2">

  <section class="ecosystem-template-01-title">
    <a href="/agv-amr/case-studies">
      <img src="../images/pc/products_detail_arrow.png"/>
    </a>
    <h1>적용사례</h1>
  </section>

  <section class="product-info">
    <!-- 카테고리 -->
    <div class="product-category">
      <span th:utext="${robotResponse.categoryNm}"></span>
    </div>
    <!-- 타이틀 -->
    <div class="product-title" th:utext="${robotResponse.robotNm}"></div>
    <!-- 설명 -->
    <div class="product-desc" th:utext="${robotResponse.description}"></div>
  </section>


  <section class="product-image">
    <!-- 썸네일 or 동영상 -->
    <th:block th:each="file : ${robotFileList}">
      <img th:src="@{${file.filePath}}" alt="로봇 이미지"/>
    </th:block>
  </section>

  <section class="product-spec">
    <span th:utext="${robotResponse.productSpac}"></span>
  </section>

  <section class="ecosystem-template-01-section">
    <div class="tab-nav">
      <div class="tab-nav-wrapper">


        <input type="radio" id="nav1" name="nav" checked/>
        <label for="nav1" class="ecosystem-nav1">
          <span>전체</span>
        </label>
        <th:block th:each="robotCategory, stat : ${robotCategory}">
          <input type="radio" th:id="'nav' + ${stat.index + 2}" name="nav"/>
          <label th:for="'nav' + ${stat.index + 2}"
                 th:data-category="${robotCategory.categoryNm}"
                 th:data-category-no="${robotCategory.categoryNo}">
            <span th:text="${robotCategory.categoryNm}" style="max-width: 88px"></span>
          </label>
        </th:block>

        <select class="tab-nav-mobile">
          <option value="" th:selected="true">전체</option>
          <th:block th:each="robotCategory, stat : ${robotCategory}">
            <option th:value="${robotCategory.categoryNo}"
                    th:text="${robotCategory.categoryNm}"></option>
          </th:block>
        </select>


        <div class="tab-content-wrapper">


          <div class="nav-content">
            <div class="casestudies-template-01-slider1">
            </div>
          </div>


          <div class="paging" style="position: absolute;bottom: -70px">
          </div>

        </div>
      </div>
    </div>

  </section>


  <form id="form">
    <input type="hidden" name="size" id="size" value="8"/>
    <input type="hidden" name="page" id="page" value="1"/>
  </form>

  <script id="slider-template" type="x-tmpl-mustache" class="hide">
    {{#items}}
      <a href="/agv-amr/case-studies/{{robotNo}}" class="casestudies-template-01-slider-item">
        <div class="casestudies-template-01-slider-item-img">
          <img src="{{thumbnailUrl}}" alt="{{robotNm}}" />
        </div>
        <p>{{robotNm}}</p>
        <span>{{description}}</span>
      </a>
    {{/items}}
    {{^items}} <p> 조회된 결과가 없습니다 </p>{{/items}}

  </script>


</main>
</body>

<th:block layout:fragment="script">
  <script type="text/javascript">

    $(document).ready(function () {
      getList();

      $("input[name='nav']").on("change", function () {
        console.log("카테고리 변경");
        let categoryNo = $(this).next("label").data("category-no") || "";
        getList(1, categoryNo);
      });

      $(".tab-nav-mobile").on("change", function () {
        let categoryNo = $(this).val();
        getList(1, categoryNo);
      });

    });

    function getList(page, categoryNo) {
      if (typeof page != "undefined" && page != null) {
        $('#page').val(page);
      }

      console.log('페이지: ' + $('#page').val())
      console.log('카테고리: ' + categoryNo)

      COMM.ajaxPagingList({
            url: '/agv-amr/case-studies',
            type: 'POST',
            data: {
              boardType1: 'ROBOT_CASE',
              boardType2: 'AVG_AMR',
              categoryNo: categoryNo,
              page: $('#page').val()
            },
            dataType: 'json',
          },
          function success(data) {
            console.log("응답 데이터:", data.contents);

            // if (data.contents.length === 0) {
            //   $(".casestudies-template-01-slider1").html("<p>등록된 적용사례가 없습니다.</p>");
            //   return;
            // }

            const template = $("#slider-template").html();
            const rendered = Mustache.render(template, {items: data.contents});

            console.log(rendered)

            $('.casestudies-template-01-slider1').html(rendered);
            $('.nav-content').show();


            if (data.totalElements != 0) {
              setPagination(data, $('.paging'));
              $('.paging').show()
            } else {
              $('.paging').hide()
            }
          });
    }


  </script>
</th:block>

</html>
